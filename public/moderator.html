<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moder√°tor - Na lovu</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        h2 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #f5576c;
            padding-bottom: 10px;
        }

        .round-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-start {
            background: #4CAF50;
        }

        .btn-cashbuilder {
            background: #2196F3;
        }

        .btn-headtohead {
            background: #FF9800;
        }

        .btn-finalchase {
            background: #9C27B0;
        }

        .btn-reset {
            background: #f44336;
        }

        .btn-reveal {
            background: #00BCD4;
        }

        .btn-send {
            background: #4CAF50;
        }

        .question-form {
            margin-top: 20px;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .status-card {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f5576c;
        }

        .status-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .status-card p {
            color: #333;
            font-size: 1.5em;
            font-weight: bold;
        }

        .answer-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .answer-box {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .answer-box.received {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
        }

        .answer-box.waiting {
            background: #fff3e0;
            border: 2px solid #FF9800;
        }

        .history-item {
            background: #f5f5f5;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }

        .correct {
            color: #4CAF50;
            font-weight: bold;
        }

        .incorrect {
            color: #f44336;
            font-weight: bold;
        }

        .position-setter {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .position-setter input {
            width: 100px;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∫ Moder√°tor - Na lovu</h1>

        <div class="panel">
            <h2>Ovl√°d√°n√≠ hry</h2>
            <div class="round-buttons">
                <button class="btn-cashbuilder" onclick="startRound('cashbuilder')">Penƒõ≈æn√≠ honba</button>
                <button class="btn-headtohead" onclick="startRound('headtohead')">Souboj tv√°≈ô√≠ v tv√°≈ô</button>
                <button class="btn-finalchase" onclick="startRound('finalchase')">Fin√°ln√≠ honba</button>
                <button class="btn-reset" onclick="resetGame()">Reset hry</button>
            </div>
        </div>

        <div class="panel">
            <h2>Stav hry</h2>
            <div class="game-status">
                <div class="status-card">
                    <h3>Kolo</h3>
                    <p id="currentRound">ƒåek√°n√≠</p>
                </div>
                <div class="status-card">
                    <h3>Sk√≥re soutƒõ≈æ√≠c√≠ho</h3>
                    <p id="contestantScore">0 Kƒç</p>
                </div>
                <div class="status-card">
                    <h3>Pozice soutƒõ≈æ√≠c√≠ho</h3>
                    <p id="contestantPosition">0</p>
                </div>
                <div class="status-card">
                    <h3>Pozice lovce</h3>
                    <p id="chaserPosition">-3</p>
                </div>
            </div>

            <div class="answer-status">
                <div class="answer-box waiting" id="contestantAnswerBox">
                    <strong>Soutƒõ≈æ√≠c√≠</strong>
                    <p id="contestantAnswer">ƒåek√° na odpovƒõƒè...</p>
                </div>
                <div class="answer-box waiting" id="chaserAnswerBox">
                    <strong>Lovec</strong>
                    <p id="chaserAnswer">ƒåek√° na odpovƒõƒè...</p>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Odeslat ot√°zku</h2>
            <div class="question-form">
                <textarea id="questionText" placeholder="Zadejte text ot√°zky..."></textarea>
                
                <div class="answer-options">
                    <input type="text" id="answerA" placeholder="Odpovƒõƒè A">
                    <input type="text" id="answerB" placeholder="Odpovƒõƒè B">
                    <input type="text" id="answerC" placeholder="Odpovƒõƒè C">
                </div>
                
                <button class="btn-send" onclick="sendQuestion()">Odeslat ot√°zku</button>
            </div>
        </div>

        <div class="panel">
            <h2>Odhalit spr√°vnou odpovƒõƒè</h2>
            <div class="round-buttons">
                <button class="btn-reveal" onclick="revealAnswer('A')">Spr√°vn√°: A</button>
                <button class="btn-reveal" onclick="revealAnswer('B')">Spr√°vn√°: B</button>
                <button class="btn-reveal" onclick="revealAnswer('C')">Spr√°vn√°: C</button>
            </div>
            
            <div class="position-setter" id="headToHeadSettings" style="display: none;">
                <label>Nastavit startovn√≠ pozici (kroky p≈ôed lovcem):</label>
                <input type="number" id="startPosition" value="3" min="1" max="7">
                <button class="btn-send" onclick="setHeadToHeadStart()">Nastavit</button>
            </div>
        </div>

        <div class="panel">
            <h2>Historie ot√°zek</h2>
            <div id="questionHistory"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let gameState = {};

        socket.on('gameState', (state) => {
            gameState = state;
            updateDisplay();
        });

        socket.on('newQuestion', (question) => {
            document.getElementById('contestantAnswerBox').className = 'answer-box waiting';
            document.getElementById('chaserAnswerBox').className = 'answer-box waiting';
            document.getElementById('contestantAnswer').textContent = 'ƒåek√° na odpovƒõƒè...';
            document.getElementById('chaserAnswer').textContent = 'ƒåek√° na odpovƒõƒè...';
        });

        socket.on('answerSubmitted', (data) => {
            if (data.role === 'contestant') {
                document.getElementById('contestantAnswerBox').className = 'answer-box received';
                document.getElementById('contestantAnswer').textContent = `Odpovƒõƒè: ${data.answer}`;
            } else if (data.role === 'chaser') {
                document.getElementById('chaserAnswerBox').className = 'answer-box received';
                document.getElementById('chaserAnswer').textContent = `Odpovƒõƒè: ${data.answer}`;
            }
        });

        socket.on('answerRevealed', (result) => {
            updateHistory();
        });

        function updateDisplay() {
            const roundNames = {
                'waiting': 'ƒåek√°n√≠',
                'cashbuilder': 'Penƒõ≈æn√≠ honba',
                'headtohead': 'Souboj tv√°≈ô√≠ v tv√°≈ô',
                'finalchase': 'Fin√°ln√≠ honba'
            };

            document.getElementById('currentRound').textContent = roundNames[gameState.round] || 'Nezn√°m√©';
            document.getElementById('contestantScore').textContent = gameState.contestantScore + ' Kƒç';
            document.getElementById('contestantPosition').textContent = gameState.contestantPosition;
            document.getElementById('chaserPosition').textContent = gameState.chaserPosition;

            // Show/hide head-to-head settings
            const headToHeadSettings = document.getElementById('headToHeadSettings');
            if (gameState.round === 'headtohead') {
                headToHeadSettings.style.display = 'flex';
            } else {
                headToHeadSettings.style.display = 'none';
            }

            updateHistory();
        }

        function updateHistory() {
            const historyDiv = document.getElementById('questionHistory');
            historyDiv.innerHTML = '';

            if (gameState.questionHistory && gameState.questionHistory.length > 0) {
                gameState.questionHistory.slice().reverse().forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <strong>Ot√°zka ${gameState.questionHistory.length - index}:</strong> ${item.question.text}<br>
                        <strong>Spr√°vn√° odpovƒõƒè:</strong> ${item.correctAnswer}<br>
                        <strong>Soutƒõ≈æ√≠c√≠:</strong> ${item.contestantAnswer} 
                        <span class="${item.contestantCorrect ? 'correct' : 'incorrect'}">
                            ${item.contestantCorrect ? '‚úì' : '‚úó'}
                        </span><br>
                        <strong>Lovec:</strong> ${item.chaserAnswer} 
                        <span class="${item.chaserCorrect ? 'correct' : 'incorrect'}">
                            ${item.chaserCorrect ? '‚úì' : '‚úó'}
                        </span>
                    `;
                    historyDiv.appendChild(div);
                });
            } else {
                historyDiv.innerHTML = '<p style="color: #999; text-align: center;">Zat√≠m ≈æ√°dn√© ot√°zky</p>';
            }
        }

        function startRound(round) {
            socket.emit('startRound', round);
        }

        function resetGame() {
            if (confirm('Opravdu chcete resetovat hru?')) {
                socket.emit('resetGame');
            }
        }

        function sendQuestion() {
            const text = document.getElementById('questionText').value.trim();
            const answerA = document.getElementById('answerA').value.trim();
            const answerB = document.getElementById('answerB').value.trim();
            const answerC = document.getElementById('answerC').value.trim();

            if (!text || !answerA || !answerB || !answerC) {
                alert('Vypl≈àte pros√≠m v≈°echna pole!');
                return;
            }

            const question = {
                text,
                answers: { A: answerA, B: answerB, C: answerC }
            };

            socket.emit('sendQuestion', question);

            // Clear form
            document.getElementById('questionText').value = '';
            document.getElementById('answerA').value = '';
            document.getElementById('answerB').value = '';
            document.getElementById('answerC').value = '';
        }

        function revealAnswer(answer) {
            socket.emit('revealAnswer', answer);
        }

        function setHeadToHeadStart() {
            const position = parseInt(document.getElementById('startPosition').value);
            if (position >= 1 && position <= 7) {
                socket.emit('setHeadToHeadStart', position);
            } else {
                alert('Pozice mus√≠ b√Ωt mezi 1 a 7');
            }
        }
    </script>
</body>
</html>
